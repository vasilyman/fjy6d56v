"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[810],{1810:(t,e,n)=>{n.r(e),n.d(e,{CartPage:()=>B});var r=n(7378),a=n(8922),i=n(2952),l=n(4174);const c={"cart-list":"style-module_cart-list-FPGZh","cart-list__empty":"style-module_cart-list__empty-fsM4X"};var u=n(8944);const o={"cart-item":"style-module_cart-item-z1TeO","cart-item__row":"style-module_cart-item__row-FoeA2","cart-item__image":"style-module_cart-item__image-VTGmV","cart-item__content":"style-module_cart-item__content-U9WW7","cart-item__title":"style-module_cart-item__title-F4AE0","cart-item__description":"style-module_cart-item__description-BeOPp","cart-item__action":"style-module_cart-item__action-aCDiE","cart-item__sum":"style-module_cart-item__sum-Dbis5",ellipsis:"style-module_ellipsis-IAM2m"};var s=n(1092);var m=n(2004),d=n(2987);function f(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var v,p=function(t){var e=t.id,n=t.className,a=function(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,i,l,c=[],u=!0,o=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(c.push(r.value),c.length!==e);u=!0);}catch(t){o=!0,a=t}finally{try{if(!u&&null!=n.return&&(l=n.return(),Object(l)!==l))return}finally{if(o)throw a}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return f(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}((0,d.zd)(),1)[0],i=(0,d.uZ)(null).data,l=(0,r.useMemo)((function(){var t,n;return null!==(t=null==i||null===(n=i.find((function(t){return t.id===e})))||void 0===n?void 0:n.qty)&&void 0!==t?t:0}),[i,e]);return r.createElement("button",{type:"button",title:"Убрать из корзины",className:(0,u.Z)("style-module_remove-from-cart-y75pS",n),onClick:function(){return a([{id:e,qty:l}])}},r.createElement(m.JO,{name:"trash",size:"24"}))},y=function(t){var e=t.sum,n=t.imgUrl,a=t.title,i=t.description,l=t.id,c=t.category,m=new Intl.NumberFormat("ru-RU",{maximumSignificantDigits:3}).format(e),d={id:l,category:c,title:a,sum:e,description:i,imgUrl:n};return r.createElement(r.Fragment,null,r.createElement("section",{className:o["cart-item__row"]},r.createElement("img",{className:(0,u.Z)(o["cart-item__image"]),src:n}),r.createElement("div",{className:(0,u.Z)(o["cart-item__content"])},r.createElement("div",{className:(0,u.Z)(o["cart-item__title"])},a),r.createElement("div",{className:(0,u.Z)(o["cart-item__description"])},i)),r.createElement("div",{className:o["cart-item__action"]},r.createElement("div",{className:o["cart-item__sum"],title:m},r.createElement("span",{className:o.ellipsis},m),r.createElement("span",null," ₽")),r.createElement(s.Sb,{className:(0,u.Z)(o["cart-item__add-to-card"]),product:d}),r.createElement(p,{id:l}))))},_=n(9876),g=n(2157);function b(){return b=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)({}).hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},b.apply(null,arguments)}var h,E,O,j=(0,_.Ps)(v||(h=["\n  query GetList($ids: [String!], $limit: Int) {\n    products {\n      getMany(input: { pagination: { pageSize: $limit }, ids: $ids }) {\n        data {\n          id\n          name\n          desc\n          photo\n          price\n        }\n        pagination {\n          pageSize\n          pageNumber\n          total\n        }\n      }\n    }\n  }\n"],E||(E=h.slice(0)),v=Object.freeze(Object.defineProperties(h,{raw:{value:Object.freeze(E)}})))),N=function(t){var e=t.className,n=(0,a.$G)().t,i=(0,d.uZ)(null).data,l=(0,r.useMemo)((function(){var t;return Object.fromEntries(null!==(t=null==i?void 0:i.map((function(t){return[t.id,t]})))&&void 0!==t?t:[])}),[i]),o=(0,r.useMemo)((function(){return Object.keys(l)}),[l]),s=(0,g.aM)(j,{variables:{ids:o,limit:o.length},skip:!o.length}),m=s.data,f=s.previousData,v=(0,r.useMemo)((function(){var t,e;return(null==i?void 0:i.length)>0&&null!==(t=null===(e=m||f)||void 0===e||null===(e=e.products.getMany.data)||void 0===e?void 0:e.map((function(t){var e;return{id:t.id,sum:t.price,qty:null===(e=l[t.id])||void 0===e?void 0:e.qty,imgUrl:t.photo,title:t.name,description:t.desc,category:t.category}})))&&void 0!==t?t:[]}),[l,m,f,i]);return r.createElement("section",{className:(0,u.Z)(e,c["cart-list"])},0===v.length?r.createElement("div",{className:c["cart-list__empty"]},n("translation:cartEmpty")):v.map((function(t){return r.createElement(y,b({key:t.id},t,{className:c["cart-list__item"]}))})))},M=n(8537),w=n(6125),S=n(9969);function A(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,a,i,l,c=[],u=!0,o=!1;try{if(i=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=i.call(n)).done)&&(c.push(r.value),c.length!==e);u=!0);}catch(t){o=!0,a=t}finally{try{if(!u&&null!=n.return&&(l=n.return(),Object(l)!==l))return}finally{if(o)throw a}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return $(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}var z=(0,_.Ps)(O||(O=function(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}(["\n  mutation Mutation($input: OrderAddInput!) {\n    orders {\n      add(input: $input) {\n        status\n      }\n    }\n  }\n"]))),Z=function(t){var e=t.className,n=(0,a.$G)().t,i=(0,d.uZ)(null).data,l=(0,w.v9)(S.u.getAccess),c=A((0,M.D)(z,{context:{headers:{authorization:"Bearer ".concat(l)}}}),2),u=c[0],o=c[1].loading,s=A((0,d.TI)(),1)[0];return r.createElement(m.zx,{className:e,label:n("translation:addOrder"),disabled:o,onClick:function(){var t=i.map((function(t){return{id:t.id,quantity:t.qty}}));u({variables:{input:{products:t}}}).then((function(){s([])})).catch((function(t){console.log(t)}))}})};const P={"cart-total":"style-module_cart-total-QEFR7","cart-total__sum":"style-module_cart-total__sum-wumw4"};var I,k=n(9205),q=(0,_.Ps)(I||(I=function(t,e){return e||(e=t.slice(0)),Object.freeze(Object.defineProperties(t,{raw:{value:Object.freeze(e)}}))}(["\n  query GetList($ids: [String!], $limit: Int) {\n    products {\n      getMany(input: { pagination: { pageSize: $limit }, ids: $ids }) {\n        data {\n          id\n          price\n          oldPrice\n        }\n      }\n    }\n  }\n"]))),G=function(){var t=(0,a.$G)().t,e=(0,d.uZ)(null).data,n=(0,r.useMemo)((function(){var t;return Object.fromEntries(null!==(t=null==e?void 0:e.map((function(t){return[t.id,t]})))&&void 0!==t?t:[])}),[e]),i=(0,r.useMemo)((function(){return Object.keys(n)}),[n]),l=(0,g.aM)(q,{variables:{ids:i,limit:i.length},skip:!i.length}),c=l.data,o=l.previousData,s=(0,r.useMemo)((function(){var t,e,n=null!==(t=null===(e=c||o)||void 0===e?void 0:e.products.getMany.data)&&void 0!==t?t:[];return Object.fromEntries(n.map((function(t){return[t.id,{sum:t.price,sumBase:t.oldPrice}]})))}),[c,o]),m=(0,r.useMemo)((function(){var t,n={sum:0,sumBase:0};return null!==(t=null==e?void 0:e.reduce((function(t,e){var n,r,a,i;return t.sum+=(null!==(n=null===(r=s[e.id])||void 0===r?void 0:r.sum)&&void 0!==n?n:0)*e.qty,t.sumBase+=(null!==(a=null===(i=s[e.id])||void 0===i?void 0:i.sumBase)&&void 0!==a?a:0)*e.qty,t}),n))&&void 0!==t?t:n}),[s,e]);return r.createElement("div",{className:(0,u.Z)(P["cart-total"])},r.createElement("div",{className:(0,u.Z)(P["cart-total__sum"])},t("translation:cartTotal"),":"),r.createElement(k.G,{sum:m.sum,sumBase:m.sumBase}),r.createElement(Z,{className:P["cart-total__add-order"]}))},B=function(){var t=(0,a.$G)().t;return r.createElement("main",null,r.createElement(i.W,null,r.createElement("h1",null,(0,l.o)(t("translation:cartPageTitle")))),r.createElement(i.W,null,r.createElement(N,null),r.createElement(G,null)))}}}]);
//# sourceMappingURL=810.js.map